{"version":3,"sources":["../../src/interface/contact.js"],"names":["getUserByUserName","isRoomContact","isSpContact","isPublicContact","ContactFactory","CONF","memberList","UserName","length","find","contact","getDisplayName","MemberCount","RemarkName","DisplayName","NickName","MemberList","test","SPECIALUSERS","indexOf","VerifyFlag","MM_USERATTRVERIFYFALG_BIZ_BRAND","contactProto","init","instance","OriginalNickName","OrignalNickName","OriginalRemarkName","OrignalRemarkName","OriginalDisplayName","OrignalDisplayName","isSelf","user","canSearch","keyword","toUpperCase","isSatisfy","key","RemarkPYQuanPin","PYQuanPin","Alias","KeyWord","extend","contactObj","Object","setPrototypeOf","contacts","getSearchUser","users","push"],"mappings":";;;;;;QAwCgBA,iB,GAAAA,iB;QAoBAC,a,GAAAA,a;QAIAC,W,GAAAA,W;QAIAC,e,GAAAA,e;kBAoCQC,c;;AAxGxB;;AAIA,IAAMC,OAAO,oBAAb;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCO,SAASL,iBAAT,CAA4BM,UAA5B,EAAwCC,QAAxC,EAAkD;AACvD,MAAI,CAACD,WAAWE,MAAhB,EAAwB,OAAO,IAAP;;AAExB,SAAOF,WAAWG,IAAX,CAAgB;AAAA,WAAWC,QAAQH,QAAR,KAAqBA,QAAhC;AAAA,GAAhB,CAAP;AACD;;AAEM,SAASI,eAAT,CAAyBD,OAAzB,EAAkC;AACvC,MAAIT,cAAcS,OAAd,CAAJ,EAA4B;AAC1B,QAAIA,QAAQE,WAAR,IAAuB,CAA3B,EAA8B;AAC5B,aAAO,UAAUF,QAAQG,UAAR,IAAsBH,QAAQI,WAA9B,IAA6CJ,QAAQK,QAArD,IACdJ,gBAAeD,QAAQM,UAAR,CAAmB,CAAnB,CAAf,CADc,cAC2BL,gBAAeD,QAAQM,UAAR,CAAmB,CAAnB,CAAf,CADrC,CAAP;AAED,KAHD,MAGO;AACL,aAAO,UAAUN,QAAQG,UAAR,IAAsBH,QAAQI,WAA9B,IAA6CJ,QAAQK,QAArD,SACZJ,gBAAeD,QAAQM,UAAR,CAAmB,CAAnB,CAAf,CADE,CAAP;AAED;AACF,GARD,MAQO;AACL,WAAON,QAAQI,WAAR,IAAuBJ,QAAQG,UAA/B,IAA6CH,QAAQK,QAArD,IAAiEL,QAAQH,QAAhF;AACD;AACF;;;AAEM,SAASN,aAAT,CAAwBS,OAAxB,EAAiC;AACtC,SAAOA,QAAQH,QAAR,GAAmB,iBAAiBU,IAAjB,CAAsBP,QAAQH,QAA9B,CAAnB,GAA6D,KAApE;AACD;;AAEM,SAASL,WAAT,CAAsBQ,OAAtB,EAA+B;AACpC,SAAOL,KAAKa,YAAL,CAAkBC,OAAlB,CAA0BT,QAAQH,QAAlC,KAA+C,CAAtD;AACD;;AAEM,SAASJ,eAAT,CAA0BO,OAA1B,EAAmC;AACxC,SAAOA,QAAQU,UAAR,GAAqBf,KAAKgB,+BAAjC;AACD;;AAED,IAAMC,eAAe;AACnBC,QAAM,cAAUC,QAAV,EAAoB;AACxB;AACA,SAAKC,gBAAL,GAAwB,KAAKC,eAAL,GAAuB,KAAKX,QAApD;AACA,SAAKY,kBAAL,GAA0B,KAAKC,iBAAL,GAAyB,KAAKf,UAAxD;AACA,SAAKgB,mBAAL,GAA2B,KAAKC,kBAAL,GAA0B,KAAKhB,WAA1D;AACA,SAAKC,QAAL,GAAgB,wBAAa,KAAKA,QAAlB,CAAhB;AACA,SAAKF,UAAL,GAAkB,wBAAa,KAAKA,UAAlB,CAAlB;AACA,SAAKC,WAAL,GAAmB,wBAAa,KAAKA,WAAlB,CAAnB;AACA,SAAKiB,MAAL,GAAc,KAAKxB,QAAL,KAAkBiB,SAASQ,IAAT,CAAczB,QAA9C;;AAEA,WAAO,IAAP;AACD,GAZkB;AAanBI,kBAAgB,0BAAY;AAC1B,WAAOA,gBAAe,IAAf,CAAP;AACD,GAfkB;AAgBnBsB,aAAW,mBAAUC,OAAV,EAAmB;AAC5B,QAAI,CAACA,OAAL,EAAc,OAAO,KAAP;AACdA,cAAUA,QAAQC,WAAR,EAAV;;AAEA,QAAIC,YAAY,SAAZA,SAAY;AAAA,aAAO,CAACC,OAAO,EAAR,EAAYF,WAAZ,GAA0BhB,OAA1B,CAAkCe,OAAlC,KAA8C,CAArD;AAAA,KAAhB;AACA,WACEE,UAAU,KAAKvB,UAAf,KACAuB,UAAU,KAAKE,eAAf,CADA,IAEAF,UAAU,KAAKrB,QAAf,CAFA,IAGAqB,UAAU,KAAKG,SAAf,CAHA,IAIAH,UAAU,KAAKI,KAAf,CAJA,IAKAJ,UAAU,KAAKK,OAAf,CANF;AAQD;AA7BkB,CAArB;;AAgCe,SAASrC,cAAT,CAAyBoB,QAAzB,EAAmC;AAChD,SAAO;AACLkB,YAAQ,gBAAUC,UAAV,EAAsB;AAC5BA,mBAAaC,OAAOC,cAAP,CAAsBF,UAAtB,EAAkCrB,YAAlC,CAAb;AACA,aAAOqB,WAAWpB,IAAX,CAAgBC,QAAhB,CAAP;AACD,KAJI;AAKLxB,uBAAmB,2BAAUO,QAAV,EAAoB;AACrC,aAAOiB,SAASsB,QAAT,CAAkBvC,QAAlB,CAAP;AACD,KAPI;AAQLwC,mBAAe,uBAAUb,OAAV,EAAmB;AAChC,UAAIc,QAAQ,EAAZ;AACA,WAAK,IAAIX,GAAT,IAAgBb,SAASsB,QAAzB,EAAmC;AACjC,YAAItB,SAASsB,QAAT,CAAkBT,GAAlB,EAAuBJ,SAAvB,CAAiCC,OAAjC,CAAJ,EAA+C;AAC7Cc,gBAAMC,IAAN,CAAWzB,SAASsB,QAAT,CAAkBT,GAAlB,CAAX;AACD;AACF;AACD,aAAOW,KAAP;AACD,KAhBI;AAiBLjB,YAAQ,gBAAUrB,OAAV,EAAmB;AACzB,aAAOA,QAAQqB,MAAR,IAAkBrB,QAAQH,QAAR,KAAqBiB,SAASQ,IAAT,CAAczB,QAA5D;AACD,KAnBI;AAoBLI,mCApBK;AAqBLV,gCArBK;AAsBLE,oCAtBK;AAuBLD;AAvBK,GAAP;AAyBD","file":"contact.js","sourcesContent":["import {\r\n  convertEmoji,\r\n  getCONF\r\n} from '../util'\r\nconst CONF = getCONF()\r\n\r\n/* Contact Object Example\r\n{\r\n  \"Uin\": 0,\r\n  \"UserName\": \"\",\r\n  \"NickName\": \"\",\r\n  \"HeadImgUrl\": \"\",\r\n  \"ContactFlag\": 3,\r\n  \"MemberCount\": 0,\r\n  \"MemberList\": [],\r\n  \"RemarkName\": \"\",\r\n  \"HideInputBarFlag\": 0,\r\n  \"Sex\": 0,\r\n  \"Signature\": \"\",\r\n  \"VerifyFlag\": 8,\r\n  \"OwnerUin\": 0,\r\n  \"PYInitial\": \"\",\r\n  \"PYQuanPin\": \"\",\r\n  \"RemarkPYInitial\": \"\",\r\n  \"RemarkPYQuanPin\": \"\",\r\n  \"StarFriend\": 0,\r\n  \"AppAccountFlag\": 0,\r\n  \"Statues\": 0,\r\n  \"AttrStatus\": 0,\r\n  \"Province\": \"\",\r\n  \"City\": \"\",\r\n  \"Alias\": \"Urinxs\",\r\n  \"SnsFlag\": 0,\r\n  \"UniFriend\": 0,\r\n  \"DisplayName\": \"\",\r\n  \"ChatRoomId\": 0,\r\n  \"KeyWord\": \"gh_\",\r\n  \"EncryChatRoomId\": \"\"\r\n}\r\n*/\r\nexport function getUserByUserName (memberList, UserName) {\r\n  if (!memberList.length) return null\r\n\r\n  return memberList.find(contact => contact.UserName === UserName)\r\n}\r\n\r\nexport function getDisplayName (contact) {\r\n  if (isRoomContact(contact)) {\r\n    if (contact.MemberCount >= 2) {\r\n      return '[群] ' + (contact.RemarkName || contact.DisplayName || contact.NickName ||\r\n      `${getDisplayName(contact.MemberList[0])}、${getDisplayName(contact.MemberList[1])}`)\r\n    } else {\r\n      return '[群] ' + (contact.RemarkName || contact.DisplayName || contact.NickName ||\r\n        `${getDisplayName(contact.MemberList[0])}`)\r\n    }\r\n  } else {\r\n    return contact.DisplayName || contact.RemarkName || contact.NickName || contact.UserName\r\n  }\r\n}\r\n\r\nexport function isRoomContact (contact) {\r\n  return contact.UserName ? /^@@|@chatroom$/.test(contact.UserName) : false\r\n}\r\n\r\nexport function isSpContact (contact) {\r\n  return CONF.SPECIALUSERS.indexOf(contact.UserName) >= 0\r\n}\r\n\r\nexport function isPublicContact (contact) {\r\n  return contact.VerifyFlag & CONF.MM_USERATTRVERIFYFALG_BIZ_BRAND\r\n}\r\n\r\nconst contactProto = {\r\n  init: function (instance) {\r\n    // 纠正错误以后保持兼容\r\n    this.OriginalNickName = this.OrignalNickName = this.NickName\r\n    this.OriginalRemarkName = this.OrignalRemarkName = this.RemarkName\r\n    this.OriginalDisplayName = this.OrignalDisplayName = this.DisplayName\r\n    this.NickName = convertEmoji(this.NickName)\r\n    this.RemarkName = convertEmoji(this.RemarkName)\r\n    this.DisplayName = convertEmoji(this.DisplayName)\r\n    this.isSelf = this.UserName === instance.user.UserName\r\n\r\n    return this\r\n  },\r\n  getDisplayName: function () {\r\n    return getDisplayName(this)\r\n  },\r\n  canSearch: function (keyword) {\r\n    if (!keyword) return false\r\n    keyword = keyword.toUpperCase()\r\n\r\n    let isSatisfy = key => (key || '').toUpperCase().indexOf(keyword) >= 0\r\n    return (\r\n      isSatisfy(this.RemarkName) ||\r\n      isSatisfy(this.RemarkPYQuanPin) ||\r\n      isSatisfy(this.NickName) ||\r\n      isSatisfy(this.PYQuanPin) ||\r\n      isSatisfy(this.Alias) ||\r\n      isSatisfy(this.KeyWord)\r\n    )\r\n  }\r\n}\r\n\r\nexport default function ContactFactory (instance) {\r\n  return {\r\n    extend: function (contactObj) {\r\n      contactObj = Object.setPrototypeOf(contactObj, contactProto)\r\n      return contactObj.init(instance)\r\n    },\r\n    getUserByUserName: function (UserName) {\r\n      return instance.contacts[UserName]\r\n    },\r\n    getSearchUser: function (keyword) {\r\n      let users = []\r\n      for (let key in instance.contacts) {\r\n        if (instance.contacts[key].canSearch(keyword)) {\r\n          users.push(instance.contacts[key])\r\n        }\r\n      }\r\n      return users\r\n    },\r\n    isSelf: function (contact) {\r\n      return contact.isSelf || contact.UserName === instance.user.UserName\r\n    },\r\n    getDisplayName,\r\n    isRoomContact,\r\n    isPublicContact,\r\n    isSpContact\r\n  }\r\n}\r\n"]}