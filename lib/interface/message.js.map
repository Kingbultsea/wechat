{"version":3,"sources":["../../src/interface/message.js"],"names":["MessageFactory","messageProto","init","instance","MsgType","isSendBySelf","FromUserName","user","UserName","OriginalContent","Content","indexOf","replace","contacts","MemberList","find","member","match","Contact","getDisplayName","isSendBy","contact","getPeerUserName","ToUserName","getDisplayTime","time","Date","CreateTime","getHours","getMinutes","extend","messageObj","Object","setPrototypeOf"],"mappings":";;;;;kBAgEwBA,c;;AAhExB;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA,IAAMC,eAAe;AACnBC,QAAM,cAAUC,QAAV,EAAoB;AAAA;;AACxB,SAAKC,OAAL,GAAe,CAAC,KAAKA,OAArB;AACA,SAAKC,YAAL,GAAoB,KAAKC,YAAL,KAAsBH,SAASI,IAAT,CAAcC,QAApC,IAAgD,KAAKF,YAAL,KAAsB,EAA1F;;AAEA,SAAKG,eAAL,GAAuB,KAAKC,OAA5B;AACA,QAAI,KAAKJ,YAAL,CAAkBK,OAAlB,CAA0B,IAA1B,MAAoC,CAAxC,EAA2C;AACzC,WAAKD,OAAL,GAAe,KAAKA,OAAL,CAAaE,OAAb,CAAqB,YAArB,EAAmC,iBAAS;AACzD,YAAIL,OAAOJ,SAASU,QAAT,CAAkB,MAAKP,YAAvB,EAAqCQ,UAArC,CAAgDC,IAAhD,CAAqD,kBAAU;AACxE,iBAAOC,OAAOR,QAAP,KAAoBS,KAA3B;AACD,SAFU,CAAX;AAGA,eAAOV,OAAOJ,SAASe,OAAT,CAAiBC,cAAjB,CAAgCZ,IAAhC,CAAP,GAA+CU,KAAtD;AACD,OALc,CAAf;AAMD;;AAED,SAAKP,OAAL,GAAe,KAAKA,OAAL,CAAaE,OAAb,CAAqB,OAArB,EAA8B,GAA9B,EAAmCA,OAAnC,CAA2C,OAA3C,EAAoD,GAApD,EAAyDA,OAAzD,CAAiE,SAAjE,EAA4E,IAA5E,CAAf;AACA,SAAKF,OAAL,GAAe,wBAAa,KAAKA,OAAlB,CAAf;;AAEA,WAAO,IAAP;AACD,GAnBkB;AAoBnBU,YAAU,kBAAUC,OAAV,EAAmB;AAC3B,WAAO,KAAKf,YAAL,KAAsBe,QAAQb,QAArC;AACD,GAtBkB;AAuBnBc,mBAAiB,2BAAY;AAC3B,WAAO,KAAKjB,YAAL,GAAoB,KAAKkB,UAAzB,GAAsC,KAAKjB,YAAlD;AACD,GAzBkB;AA0BnBkB,kBAAgB,0BAAY;AAC1B,QAAIC,OAAO,IAAIC,IAAJ,CAAS,MAAM,KAAKC,UAApB,CAAX;AACA,WAAOF,KAAKG,QAAL,KAAkB,GAAlB,GAAwB,qBAAUH,KAAKI,UAAL,EAAV,EAA6B,CAA7B,CAA/B;AACD;AA7BkB,CAArB;;AAgCe,SAAS7B,cAAT,CAAyBG,QAAzB,EAAmC;AAChD,SAAO;AACL2B,YAAQ,gBAAUC,UAAV,EAAsB;AAC5BA,mBAAaC,OAAOC,cAAP,CAAsBF,UAAtB,EAAkC9B,YAAlC,CAAb;AACA,aAAO8B,WAAW7B,IAAX,CAAgBC,QAAhB,CAAP;AACD;AAJI,GAAP;AAMD","file":"message.js","sourcesContent":["import {convertEmoji, formatNum} from '../util'\r\n/* Message Object Example\r\n{\r\n    \"FromUserName\": \"\",\r\n    \"ToUserName\": \"\",\r\n    \"Content\": \"\",\r\n    \"StatusNotifyUserName\": \"\",\r\n    \"ImgWidth\": 0,\r\n    \"PlayLength\": 0,\r\n    \"RecommendInfo\": {},\r\n    \"StatusNotifyCode\": 4,\r\n    \"NewMsgId\": \"\",\r\n    \"Status\": 3,\r\n    \"VoiceLength\": 0,\r\n    \"ForwardFlag\": 0,\r\n    \"AppMsgType\": 0,\r\n    \"Ticket\": \"\",\r\n    \"AppInfo\": {...},\r\n    \"Url\": \"\",\r\n    \"ImgStatus\": 1,\r\n    \"MsgType\": 1,\r\n    \"ImgHeight\": 0,\r\n    \"MediaId\": \"\",\r\n    \"MsgId\": \"\",\r\n    \"FileName\": \"\",\r\n    \"HasProductId\": 0,\r\n    \"FileSize\": \"\",\r\n    \"CreateTime\": 0,\r\n    \"SubMsgType\": 0\r\n}\r\n*/\r\n\r\nconst messageProto = {\r\n  init: function (instance) {\r\n    this.MsgType = +this.MsgType\r\n    this.isSendBySelf = this.FromUserName === instance.user.UserName || this.FromUserName === ''\r\n\r\n    this.OriginalContent = this.Content\r\n    if (this.FromUserName.indexOf('@@') === 0) {\r\n      this.Content = this.Content.replace(/^@.*?(?=:)/, match => {\r\n        let user = instance.contacts[this.FromUserName].MemberList.find(member => {\r\n          return member.UserName === match\r\n        })\r\n        return user ? instance.Contact.getDisplayName(user) : match\r\n      })\r\n    }\r\n\r\n    this.Content = this.Content.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/<br\\/>/g, '\\n')\r\n    this.Content = convertEmoji(this.Content)\r\n\r\n    return this\r\n  },\r\n  isSendBy: function (contact) {\r\n    return this.FromUserName === contact.UserName\r\n  },\r\n  getPeerUserName: function () {\r\n    return this.isSendBySelf ? this.ToUserName : this.FromUserName\r\n  },\r\n  getDisplayTime: function () {\r\n    var time = new Date(1e3 * this.CreateTime)\r\n    return time.getHours() + ':' + formatNum(time.getMinutes(), 2)\r\n  }\r\n}\r\n\r\nexport default function MessageFactory (instance) {\r\n  return {\r\n    extend: function (messageObj) {\r\n      messageObj = Object.setPrototypeOf(messageObj, messageProto)\r\n      return messageObj.init(instance)\r\n    }\r\n  }\r\n}\r\n"]}